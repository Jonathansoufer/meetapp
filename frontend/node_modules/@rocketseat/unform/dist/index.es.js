import e,{createContext as t,useContext as r,useEffect as n,useState as i,useRef as a}from"react";function o(e,t){var r,n;if("function"==typeof t)void 0!==(n=t(e))&&(e=n);else if(Array.isArray(t))for(r=0;r<t.length;r++)void 0!==(n=t[r](e))&&(e=n);return e}function l(e,t){return"-"===e[0]&&Array.isArray(t)&&/^-\d+$/.test(e)?t.length+parseInt(e,10):e}function u(e){return"[object Object]"===Object.prototype.toString.call(e)}function c(e){return Object(e)===e}function s(e){return 0===Object.keys(e).length}function f(e,t){return e.indexOf("[")>=0&&(e=e.replace(/\[/g,".").replace(/]/g,"")),e.split(t)}function p(e,t,r){if(!(this instanceof p))return new p(e,t,r);void 0===t&&(t=!1),void 0===r&&(r=!0),this.separator=e||".",this.override=t,this.useArray=r,this.keepArray=!1,this.cleanup=[]}var h=new p(".",!1,!0);function d(e){return function(){return h[e].apply(h,arguments)}}p.prototype._fill=function(e,t,r,n){var i=e.shift();if(e.length>0){if(t[i]=t[i]||(this.useArray&&function(e){return/^\d+$/.test(e)}(e[0])?[]:{}),!c(t[i])){if(!this.override){if(!c(r)||!s(r))throw new Error("Trying to redefine `"+i+"` which is a "+typeof t[i]);return}t[i]={}}this._fill(e,t[i],r,n)}else{if(!this.override&&c(t[i])&&!s(t[i])){if(!c(r)||!s(r))throw new Error("Trying to redefine non-empty obj['"+i+"']");return}t[i]=o(r,n)}},p.prototype.object=function(e,t){var r=this;return Object.keys(e).forEach(function(n){var i=void 0===t?null:t[n],a=f(n,r.separator).join(r.separator);-1!==a.indexOf(r.separator)?(r._fill(a.split(r.separator),e,e[n],i),delete e[n]):r.override&&(e[n]=o(e[n],i))}),e},p.prototype.str=function(e,t,r,n){return-1!==e.indexOf(this.separator)?this._fill(e.split(this.separator),r,t,n):r.hasOwnProperty(e)&&!this.override||(r[e]=o(t,n)),r},p.prototype.pick=function(e,t,r){var n,i,a,o,u;for(i=f(e,this.separator),n=0;n<i.length;n++){if(o=l(i[n],t),!(t&&"object"==typeof t&&o in t))return;if(n===i.length-1)return r?(a=t[o],delete t[o],Array.isArray(t)&&(u=i.slice(0,-1).join("."),-1===this.cleanup.indexOf(u)&&this.cleanup.push(u)),a):t[o];t=t[o]}return r&&Array.isArray(t)&&(t=t.filter(function(e){return void 0!==e})),t},p.prototype.remove=function(e,t){var r;if(this.cleanup=[],Array.isArray(e)){for(r=0;r<e.length;r++)this.pick(e[r],t,!0);return this._cleanup(t),t}return this.pick(e,t,!0)},p.prototype._cleanup=function(e){var t,r,n,i;if(this.cleanup.length){for(r=0;r<this.cleanup.length;r++)t=(t=(i=(n=this.cleanup[r].split(".")).splice(0,-1).join("."))?this.pick(i,e):e)[n[0]].filter(function(e){return void 0!==e}),this.set(this.cleanup[r],t,e);this.cleanup=[]}},p.prototype.del=p.prototype.remove,p.prototype.move=function(e,t,r,n,i){return"function"==typeof n||Array.isArray(n)?this.set(t,o(this.pick(e,r,!0),n),r,i):(i=n,this.set(t,this.pick(e,r,!0),r,i)),r},p.prototype.transfer=function(e,t,r,n,i,a){return"function"==typeof i||Array.isArray(i)?this.set(t,o(this.pick(e,r,!0),i),n,a):(a=i,this.set(t,this.pick(e,r,!0),n,a)),n},p.prototype.copy=function(e,t,r,n,i,a){return"function"==typeof i||Array.isArray(i)?this.set(t,o(JSON.parse(JSON.stringify(this.pick(e,r,!1))),i),n,a):(a=i,this.set(t,this.pick(e,r,!1),n,a)),n},p.prototype.set=function(e,t,r,n){var i,a,o,l;if(void 0===t)return r;for(o=f(e,this.separator),i=0;i<o.length;i++){if(l=o[i],i===o.length-1)if(n&&u(t)&&u(r[l]))for(a in t)t.hasOwnProperty(a)&&(r[l][a]=t[a]);else if(n&&Array.isArray(r[l])&&Array.isArray(t))for(var c=0;c<t.length;c++)r[o[i]].push(t[c]);else r[l]=t;else r.hasOwnProperty(l)&&(u(r[l])||Array.isArray(r[l]))||(/^\d+$/.test(o[i+1])?r[l]=[]:r[l]={});r=r[l]}return r},p.prototype.transform=function(e,t,r){return t=t||{},r=r||{},Object.keys(e).forEach(function(n){this.set(e[n],this.pick(n,t),r)}.bind(this)),r},p.prototype.dot=function(e,t,r){return t=t||{},r=r||[],Object.keys(e).forEach(function(n){if(c(e[n])&&(u(e[n])&&!s(e[n])||Array.isArray(e[n])&&!this.keepArray&&0!==e[n].length))return this.dot(e[n],t,r.concat(n));t[r.concat(n).join(this.separator)]=e[n]}.bind(this)),t},p.pick=d("pick"),p.move=d("move"),p.transfer=d("transfer"),p.transform=d("transform"),p.copy=d("copy"),p.object=d("object"),p.str=d("str"),p.set=d("set"),p.del=p.remove=d("remove"),p.dot=d("dot"),["override","overwrite"].forEach(function(e){Object.defineProperty(p,e,{get:function(){return h.override},set:function(e){h.override=!!e}})}),["useArray","keepArray"].forEach(function(e){Object.defineProperty(p,e,{get:function(){return h[e]},set:function(t){h[e]=t}})}),p._process=o;var y=p,v=t({initialData:{},errors:{},scopePath:"",registerField:function(){},unregisterField:function(){}});function m(e){var t=r(v),i=t.initialData,a=t.errors,o=t.scopePath,l=t.unregisterField,u=t.registerField,c=o?o+"."+e:e;n(function(){return function(){return l(c)}},[c]);var s=y.pick(c,i),f=a[c];return{fieldName:c,registerField:u,defaultValue:s,error:f}}var b=function(){return(b=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function g(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]])}return r}function w(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function l(a){return function(l){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}function A(t){var r=t.initialData,n=void 0===r?{}:r,a=t.children,o=t.schema,l=t.context,u=void 0===l?{}:l,c=t.onSubmit,s=g(t,["initialData","children","schema","context","onSubmit"]),f=i({}),p=f[0],h=f[1],d=i([]),m=d[0],A=d[1];function E(){m.forEach(function(e){var t=e.ref,r=e.path,n=e.clearValue;return n?n(t):y.set(r,"",t)})}return e.createElement(v.Provider,{value:{initialData:n,errors:p,scopePath:"",registerField:function(e){A(function(t){return t.concat([e])})},unregisterField:function(e){A(function(t){return t.filter(function(t){return t.name!==e})})}}},e.createElement("form",b({},s,{"data-testid":"form",onSubmit:function(e){return t=this,r=void 0,i=function(){var t,r,n;return w(this,function(i){switch(i.label){case 0:e.preventDefault(),t=function(){var e={};return m.forEach(function(t){var r=t.name,n=t.ref,i=t.path,a=t.parseValue,o=y.pick(i,n);e[r]=a?a(o):o}),y.object(e),e}(),i.label=1;case 1:return i.trys.push([1,4,,5]),o?[4,o.validate(t,{abortEarly:!1,stripUnknown:!0,context:u})]:[3,3];case 2:i.sent(),t=o.cast(t,{stripUnknown:!0,context:u}),i.label=3;case 3:return h({}),c(t,{resetForm:E}),[3,5];case 4:if(r=i.sent(),n={},!r.inner)throw r;return r.inner.forEach(function(e){n[e.path]=e.message}),h(n),[3,5];case 5:return[2]}})},new((n=void 0)||(n=Promise))(function(e,a){function o(e){try{u(i.next(e))}catch(e){a(e)}}function l(e){try{u(i.throw(e))}catch(e){a(e)}}function u(t){t.done?e(t.value):new n(function(e){e(t.value)}).then(o,l)}u((i=i.apply(t,r||[])).next())});var t,r,n,i}}),a))}function E(t){var n=t.path,i=t.children,a=r(v),o=a.scopePath,l=g(a,["scopePath"]);return e.createElement(v.Provider,{value:b({},l,{scopePath:o.concat(o?"."+n:n)})},i)}function k(t){var r=t.name,i=t.label,o=t.multiline,l=void 0!==o&&o,u=g(t,["name","label","multiline"]),c=a(null),s=m(r),f=s.fieldName,p=s.registerField,h=s.defaultValue,d=s.error;n(function(){c.current&&p({name:f,ref:c.current,path:"value"})},[c.current,f]);var y=b({},u,{ref:c,id:f,name:f,"aria-label":f,defaultValue:h});return e.createElement(e.Fragment,null,i&&e.createElement("label",{htmlFor:f},i),l?e.createElement("textarea",b({},y)):e.createElement("input",b({},y)),d&&e.createElement("span",null,d))}function O(t){return n(function(){console.warn("Textarea will be deprecated in the next major unform release. Please use <Input multiline /> instead")},[]),e.createElement(k,b({},t,{multiline:!0}))}function j(t){var r=t.name,i=t.label,o=t.placeholder,l=t.defaultValue,u=t.options,c=g(t,["name","label","placeholder","defaultValue","options"]),s=a(null),f=m(r),p=f.fieldName,h=f.registerField,d=f.defaultValue,y=f.error;return n(function(){s.current&&h({name:p,ref:s.current,path:"value"})},[s.current,p]),e.createElement(e.Fragment,null,i&&e.createElement("label",{htmlFor:p},i),e.createElement("select",b({},c,{multiple:!1,id:p,name:p,defaultValue:d||l,"aria-label":p,ref:s}),e.createElement("option",{value:l,disabled:!0,hidden:!0},o),u.map(function(t){var r=t.id,n=t.title;return e.createElement("option",{key:r,value:r},n)})),y&&e.createElement("span",null,y))}function P(t){var r=t.name,o=t.label,l=t.onStartProgress,u=g(t,["name","label","onStartProgress"]),c=a(null),s=m(r),f=s.fieldName,p=s.registerField,h=s.defaultValue,d=s.error,y=i(h),v=y[0],w=y[1];n(function(){c.current&&p({name:f,ref:c.current,path:"dataset.file",clearValue:function(e){e.value="",w("")}})},[c.current,f]);var A=b({},u,{ref:c,id:f,name:f,"aria-label":f});return e.createElement(e.Fragment,null,o&&e.createElement("label",{htmlFor:f},o),e.createElement("input",b({},A,{type:"file",onChange:function(e){var t=new FileReader;t.onload=function(e){var t=e.target.result;w(t)},t.onprogress=function(e){var t=e.loaded,r=void 0===t?0:t,n=e.total;l&&l(r/(void 0===n?0:n)*100,e)};var r=e.target.files;r&&t.readAsDataURL(r[0])},"data-file":v})),d&&e.createElement("span",null,d))}j.defaultProps={placeholder:"",defaultValue:""};export{P as FileInput,A as Form,k as Input,E as Scope,j as Select,O as Textarea,m as useField};
//# sourceMappingURL=index.es.js.map
