"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),React__default=_interopDefault(React);function _process(e,t){var r,n;if("function"==typeof t)void 0!==(n=t(e))&&(e=n);else if(Array.isArray(t))for(r=0;r<t.length;r++)void 0!==(n=t[r](e))&&(e=n);return e}function parseKey(e,t){return"-"===e[0]&&Array.isArray(t)&&/^-\d+$/.test(e)?t.length+parseInt(e,10):e}function isIndex(e){return/^\d+$/.test(e)}function isObject(e){return"[object Object]"===Object.prototype.toString.call(e)}function isArrayOrObject(e){return Object(e)===e}function isEmptyObject(e){return 0===Object.keys(e).length}function parsePath(e,t){return e.indexOf("[")>=0&&(e=e.replace(/\[/g,".").replace(/]/g,"")),e.split(t)}function DotObject(e,t,r){if(!(this instanceof DotObject))return new DotObject(e,t,r);void 0===t&&(t=!1),void 0===r&&(r=!0),this.separator=e||".",this.override=t,this.useArray=r,this.keepArray=!1,this.cleanup=[]}var dotDefault=new DotObject(".",!1,!0);function wrap(e){return function(){return dotDefault[e].apply(dotDefault,arguments)}}DotObject.prototype._fill=function(e,t,r,n){var a=e.shift();if(e.length>0){if(t[a]=t[a]||(this.useArray&&isIndex(e[0])?[]:{}),!isArrayOrObject(t[a])){if(!this.override){if(!isArrayOrObject(r)||!isEmptyObject(r))throw new Error("Trying to redefine `"+a+"` which is a "+typeof t[a]);return}t[a]={}}this._fill(e,t[a],r,n)}else{if(!this.override&&isArrayOrObject(t[a])&&!isEmptyObject(t[a])){if(!isArrayOrObject(r)||!isEmptyObject(r))throw new Error("Trying to redefine non-empty obj['"+a+"']");return}t[a]=_process(r,n)}},DotObject.prototype.object=function(e,t){var r=this;return Object.keys(e).forEach(function(n){var a=void 0===t?null:t[n],o=parsePath(n,r.separator).join(r.separator);-1!==o.indexOf(r.separator)?(r._fill(o.split(r.separator),e,e[n],a),delete e[n]):r.override&&(e[n]=_process(e[n],a))}),e},DotObject.prototype.str=function(e,t,r,n){return-1!==e.indexOf(this.separator)?this._fill(e.split(this.separator),r,t,n):r.hasOwnProperty(e)&&!this.override||(r[e]=_process(t,n)),r},DotObject.prototype.pick=function(e,t,r){var n,a,o,i,c;for(a=parsePath(e,this.separator),n=0;n<a.length;n++){if(i=parseKey(a[n],t),!(t&&"object"==typeof t&&i in t))return;if(n===a.length-1)return r?(o=t[i],delete t[i],Array.isArray(t)&&(c=a.slice(0,-1).join("."),-1===this.cleanup.indexOf(c)&&this.cleanup.push(c)),o):t[i];t=t[i]}return r&&Array.isArray(t)&&(t=t.filter(function(e){return void 0!==e})),t},DotObject.prototype.remove=function(e,t){var r;if(this.cleanup=[],Array.isArray(e)){for(r=0;r<e.length;r++)this.pick(e[r],t,!0);return this._cleanup(t),t}return this.pick(e,t,!0)},DotObject.prototype._cleanup=function(e){var t,r,n,a;if(this.cleanup.length){for(r=0;r<this.cleanup.length;r++)t=(t=(a=(n=this.cleanup[r].split(".")).splice(0,-1).join("."))?this.pick(a,e):e)[n[0]].filter(function(e){return void 0!==e}),this.set(this.cleanup[r],t,e);this.cleanup=[]}},DotObject.prototype.del=DotObject.prototype.remove,DotObject.prototype.move=function(e,t,r,n,a){return"function"==typeof n||Array.isArray(n)?this.set(t,_process(this.pick(e,r,!0),n),r,a):(a=n,this.set(t,this.pick(e,r,!0),r,a)),r},DotObject.prototype.transfer=function(e,t,r,n,a,o){return"function"==typeof a||Array.isArray(a)?this.set(t,_process(this.pick(e,r,!0),a),n,o):(o=a,this.set(t,this.pick(e,r,!0),n,o)),n},DotObject.prototype.copy=function(e,t,r,n,a,o){return"function"==typeof a||Array.isArray(a)?this.set(t,_process(JSON.parse(JSON.stringify(this.pick(e,r,!1))),a),n,o):(o=a,this.set(t,this.pick(e,r,!1),n,o)),n},DotObject.prototype.set=function(e,t,r,n){var a,o,i,c;if(void 0===t)return r;for(i=parsePath(e,this.separator),a=0;a<i.length;a++){if(c=i[a],a===i.length-1)if(n&&isObject(t)&&isObject(r[c]))for(o in t)t.hasOwnProperty(o)&&(r[c][o]=t[o]);else if(n&&Array.isArray(r[c])&&Array.isArray(t))for(var s=0;s<t.length;s++)r[i[a]].push(t[s]);else r[c]=t;else r.hasOwnProperty(c)&&(isObject(r[c])||Array.isArray(r[c]))||(/^\d+$/.test(i[a+1])?r[c]=[]:r[c]={});r=r[c]}return r},DotObject.prototype.transform=function(e,t,r){return t=t||{},r=r||{},Object.keys(e).forEach(function(n){this.set(e[n],this.pick(n,t),r)}.bind(this)),r},DotObject.prototype.dot=function(e,t,r){return t=t||{},r=r||[],Object.keys(e).forEach(function(n){if(isArrayOrObject(e[n])&&(isObject(e[n])&&!isEmptyObject(e[n])||Array.isArray(e[n])&&!this.keepArray&&0!==e[n].length))return this.dot(e[n],t,r.concat(n));t[r.concat(n).join(this.separator)]=e[n]}.bind(this)),t},DotObject.pick=wrap("pick"),DotObject.move=wrap("move"),DotObject.transfer=wrap("transfer"),DotObject.transform=wrap("transform"),DotObject.copy=wrap("copy"),DotObject.object=wrap("object"),DotObject.str=wrap("str"),DotObject.set=wrap("set"),DotObject.del=DotObject.remove=wrap("remove"),DotObject.dot=wrap("dot"),["override","overwrite"].forEach(function(e){Object.defineProperty(DotObject,e,{get:function(){return dotDefault.override},set:function(e){dotDefault.override=!!e}})}),["useArray","keepArray"].forEach(function(e){Object.defineProperty(DotObject,e,{get:function(){return dotDefault[e]},set:function(t){dotDefault[e]=t}})}),DotObject._process=_process;var dotObject=DotObject,FormContext=React.createContext({initialData:{},errors:{},scopePath:"",registerField:function(){},unregisterField:function(){}});function useField(e){var t=React.useContext(FormContext),r=t.initialData,n=t.errors,a=t.scopePath,o=t.unregisterField,i=t.registerField,c=a?a+"."+e:e;React.useEffect(function(){return function(){return o(c)}},[c]);var s=dotObject.pick(c,r),u=n[c];return{fieldName:c,registerField:i,defaultValue:s,error:u}}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function __rest(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&(r[n[a]]=e[n[a]])}return r}function __awaiter(e,t,r,n){return new(r||(r=Promise))(function(a,o){function i(e){try{s(n.next(e))}catch(e){o(e)}}function c(e){try{s(n.throw(e))}catch(e){o(e)}}function s(e){e.done?a(e.value):new r(function(t){t(e.value)}).then(i,c)}s((n=n.apply(e,t||[])).next())})}function __generator(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}function Form(e){var t=e.initialData,r=void 0===t?{}:t,n=e.children,a=e.schema,o=e.context,i=void 0===o?{}:o,c=e.onSubmit,s=__rest(e,["initialData","children","schema","context","onSubmit"]),u=React.useState({}),l=u[0],f=u[1],p=React.useState([]),d=p[0],h=p[1];function b(){d.forEach(function(e){var t=e.ref,r=e.path,n=e.clearValue;return n?n(t):dotObject.set(r,"",t)})}return React__default.createElement(FormContext.Provider,{value:{initialData:r,errors:l,scopePath:"",registerField:function(e){h(function(t){return t.concat([e])})},unregisterField:function(e){h(function(t){return t.filter(function(t){return t.name!==e})})}}},React__default.createElement("form",__assign({},s,{"data-testid":"form",onSubmit:function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n;return __generator(this,function(o){switch(o.label){case 0:e.preventDefault(),t=function(){var e={};return d.forEach(function(t){var r=t.name,n=t.ref,a=t.path,o=t.parseValue,i=dotObject.pick(a,n);e[r]=o?o(i):i}),dotObject.object(e),e}(),o.label=1;case 1:return o.trys.push([1,4,,5]),a?[4,a.validate(t,{abortEarly:!1,stripUnknown:!0,context:i})]:[3,3];case 2:o.sent(),t=a.cast(t,{stripUnknown:!0,context:i}),o.label=3;case 3:return f({}),c(t,{resetForm:b}),[3,5];case 4:if(r=o.sent(),n={},!r.inner)throw r;return r.inner.forEach(function(e){n[e.path]=e.message}),f(n),[3,5];case 5:return[2]}})})}}),n))}function Scope(e){var t=e.path,r=e.children,n=React.useContext(FormContext),a=n.scopePath,o=__rest(n,["scopePath"]);return React__default.createElement(FormContext.Provider,{value:__assign({},o,{scopePath:a.concat(a?"."+t:t)})},r)}function Input(e){var t=e.name,r=e.label,n=e.multiline,a=void 0!==n&&n,o=__rest(e,["name","label","multiline"]),i=React.useRef(null),c=useField(t),s=c.fieldName,u=c.registerField,l=c.defaultValue,f=c.error;React.useEffect(function(){i.current&&u({name:s,ref:i.current,path:"value"})},[i.current,s]);var p=__assign({},o,{ref:i,id:s,name:s,"aria-label":s,defaultValue:l});return React__default.createElement(React__default.Fragment,null,r&&React__default.createElement("label",{htmlFor:s},r),a?React__default.createElement("textarea",__assign({},p)):React__default.createElement("input",__assign({},p)),f&&React__default.createElement("span",null,f))}function Textarea(e){return React.useEffect(function(){console.warn("Textarea will be deprecated in the next major unform release. Please use <Input multiline /> instead")},[]),React__default.createElement(Input,__assign({},e,{multiline:!0}))}var defaultProps={placeholder:"",defaultValue:""};function Select(e){var t=e.name,r=e.label,n=e.placeholder,a=e.defaultValue,o=e.options,i=__rest(e,["name","label","placeholder","defaultValue","options"]),c=React.useRef(null),s=useField(t),u=s.fieldName,l=s.registerField,f=s.defaultValue,p=s.error;return React.useEffect(function(){c.current&&l({name:u,ref:c.current,path:"value"})},[c.current,u]),React__default.createElement(React__default.Fragment,null,r&&React__default.createElement("label",{htmlFor:u},r),React__default.createElement("select",__assign({},i,{multiple:!1,id:u,name:u,defaultValue:f||a,"aria-label":u,ref:c}),React__default.createElement("option",{value:a,disabled:!0,hidden:!0},n),o.map(function(e){var t=e.id,r=e.title;return React__default.createElement("option",{key:t,value:t},r)})),p&&React__default.createElement("span",null,p))}function Input$1(e){var t=e.name,r=e.label,n=e.onStartProgress,a=__rest(e,["name","label","onStartProgress"]),o=React.useRef(null),i=useField(t),c=i.fieldName,s=i.registerField,u=i.defaultValue,l=i.error,f=React.useState(u),p=f[0],d=f[1];React.useEffect(function(){o.current&&s({name:c,ref:o.current,path:"dataset.file",clearValue:function(e){e.value="",d("")}})},[o.current,c]);var h=__assign({},a,{ref:o,id:c,name:c,"aria-label":c});return React__default.createElement(React__default.Fragment,null,r&&React__default.createElement("label",{htmlFor:c},r),React__default.createElement("input",__assign({},h,{type:"file",onChange:function(e){var t=new FileReader;t.onload=function(e){var t=e.target.result;d(t)},t.onprogress=function(e){var t=e.loaded,r=void 0===t?0:t,a=e.total;n&&n(r/(void 0===a?0:a)*100,e)};var r=e.target.files;r&&t.readAsDataURL(r[0])},"data-file":p})),l&&React__default.createElement("span",null,l))}Select.defaultProps=defaultProps,exports.FileInput=Input$1,exports.Form=Form,exports.Input=Input,exports.Scope=Scope,exports.Select=Select,exports.Textarea=Textarea,exports.useField=useField;
//# sourceMappingURL=index.js.map
